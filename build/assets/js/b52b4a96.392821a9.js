"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[16],{164:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"payment methods/AliPay + Offline/alipayplus-mpm","title":"Merchant-Presented Mode (C scan B)","description":"Topics covered on this page","source":"@site/versioned_docs/version-API version 2025-05-27/payment methods/AliPay + Offline/alipayplus-mpm.mdx","sourceDirName":"payment methods/AliPay + Offline","slug":"/payment methods/AliPay + Offline/alipayplus-mpm","permalink":"/API version 2025-05-27/payment methods/AliPay + Offline/alipayplus-mpm","draft":false,"unlisted":false,"tags":[],"version":"API version 2025-05-27","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Collecting Cards","permalink":"/API version 2025-05-27/guides/collecting-card-information"},"next":{"title":"User-Presented Mode Payment (B scan C)","permalink":"/API version 2025-05-27/payment methods/AliPay + Offline/alipayplus-upm"}}');var i=r(74848),t=r(28453);const c={},a="Merchant-Presented Mode (C scan B)",l={},d=[{value:"How to enable",id:"how-to-enable",level:2},{value:"Payment flow",id:"payment-flow",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Creating a source",id:"creating-a-source",level:2},{value:"Creating a charge",id:"creating-a-charge",level:2},{value:"Creating a source and charge",id:"creating-a-source-and-charge",level:2},{value:"Setting the charge to expire",id:"setting-the-charge-to-expire",level:2},{value:"Completing the charge",id:"completing-the-charge",level:2},{value:"Authorizing the charge",id:"authorizing-the-charge",level:2},{value:"Receiving the charge completion event",id:"receiving-the-charge-completion-event",level:2},{value:"Checking the charge status",id:"checking-the-charge-status",level:2},{value:"Voids and refunds",id:"voids-and-refunds",level:2},{value:"Limits",id:"limits",level:2},{value:"Related API documentation",id:"related-api-documentation",level:2},{value:"How to check the public key and secret key",id:"how-to-check-the-public-key-and-secret-key",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"merchant-presented-mode-c-scan-b",children:"Merchant-Presented Mode (C scan B)"})}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)("em",{children:"Topics covered on this page"})}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#how-to-enable",children:"How to enable"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#payment-flow",children:"Payment flow"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#implementation",children:"Implementation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#creating-a-source",children:"Creating a source"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#creating-a-charge",children:"Creating a charge"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#creating-a-source-and-charge",children:"Creating a source and charge"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#setting-the-charge-to-expire",children:"Setting the charge to expire"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#completing-the-charge",children:"Completing the charge"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#voids-and-refunds",children:"Voids and refunds"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#limits",children:"Limits"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#related-api-documentation",children:"Related API documentation"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#how-to-check-the-public-key-and-secret-key",children:"How to check the public key and secret key"})}),"\n"]})]}),"\n",(0,i.jsxs)(n.p,{children:["Accept in-store payments from Alipay+ users through your point-of-sale system (POS) using the ",(0,i.jsx)(n.strong,{children:"Alipay+ Merchant-Presented Mode Payment (C scan B)"})," payment method."]}),"\n",(0,i.jsx)(n.p,{children:"This guide walks you through the payment flow and details how to implement it."}),"\n",(0,i.jsx)(n.h2,{id:"how-to-enable",children:"How to enable"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Supported Countries:"})," Thailand, Singapore, Malaysia"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Minimum API version:"}),"  ",(0,i.jsx)(n.code,{children:"2017-11-02"})]}),"\n"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Supported Wallets"}),(0,i.jsx)(n.th,{children:"Thailand"}),(0,i.jsx)(n.th,{children:"Singapore"}),(0,i.jsx)(n.th,{children:"Malaysia"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Alipay CN"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Alipay HK"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"KakaoPay"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"GCash"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Touch 'n Go"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"TrueMoney"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["To enable ",(0,i.jsx)(n.strong,{children:"Merchant-Presented Mode (C scan B)"}),", send an email requesting this feature to ",(0,i.jsx)(n.a,{href:"mailto:support@omise.co",children:"support@omise.co"}),". You will need to review and accept new terms and conditions."]}),"\n",(0,i.jsx)(n.h2,{id:"payment-flow",children:"Payment flow"}),"\n",(0,i.jsxs)(n.p,{children:["Customers paying via Merchant-Presented Mode (C scan B) go through an ",(0,i.jsx)(n.em,{children:"offline"}),' payment flow. This means that once the charge is created, it can only be authorized "offline". In this case, the customer must scan the generated QR code with the supported wallet app on their phone to complete the flow.']}),"\n",(0,i.jsx)(n.p,{children:"Your POS device should generate the QR code after the customer selects Merchant-Presented Mode (C scan B) as their preferred payment method."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"alipayplus",src:r(42656).A+"",width:"4801",height:"2001"})}),"\n",(0,i.jsxs)(n.p,{children:["\u2776 ",(0,i.jsx)(n.em,{children:"The customer opens an Alipay+ supported wallet on their mobile phone."}),(0,i.jsx)(n.br,{}),"\n","\u2777 ",(0,i.jsx)(n.em,{children:"Then, the customer scans the QR code displayed in the merchant POS."}),(0,i.jsx)(n.br,{}),"\n","\u2778 ",(0,i.jsx)(n.em,{children:"The customer reviews payment information."}),"  \u2779 ",(0,i.jsx)(n.em,{children:"The customer confirms the payment."}),(0,i.jsx)(n.br,{}),"\n","\u277a ",(0,i.jsx)(n.em,{children:"When the payment is successful, the wallet application will notify the customer."})]}),"\n",(0,i.jsx)(n.h2,{id:"implementation",children:"Implementation"}),"\n",(0,i.jsxs)(n.p,{children:["Make the following API requests to create a charge using ",(0,i.jsx)(n.strong,{children:"Merchant-Presented Mode (C scan B)"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Create a new payment ",(0,i.jsx)(n.a,{href:"/sources-api#create",children:"source"})," ( ",(0,i.jsx)(n.code,{children:"type"})," :  ",(0,i.jsx)(n.code,{children:"alipayplus_mpm"})," ) using ",(0,i.jsx)(n.a,{href:"/th/omise-js/thailand",children:"Omise.js"})," or one of the mobile SDKs (",(0,i.jsx)(n.a,{href:"https://github.com/omise/omise-ios",children:"iOS"}),"  and ",(0,i.jsx)(n.a,{href:"https://github.com/omise/omise-android",children:"Android"})," )."]}),"\n",(0,i.jsxs)(n.li,{children:["Create a new  ",(0,i.jsx)(n.a,{href:"/charges-api#create",children:"charge"})," using the identifier of the source created in Step 1."]}),"\n",(0,i.jsxs)(n.li,{children:["After receiving the charge completion webhook event, retrieve the charge to verify its status (",(0,i.jsx)(n.em,{children:"optional, but recommended"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Use your ",(0,i.jsx)(n.strong,{children:"public key"})," to create the Merchant-Presented Mode (C scan B) source on the client (a customer's browser or mobile phone). Use your ",(0,i.jsx)(n.strong,{children:"secret key"})," to create the Merchant-Presented Mode (C scan B) charge on the server."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["If both the creation and charge of a source must happen server-side, you can create and charge the source in a ",(0,i.jsx)(n.a,{href:"/alipayplus-mpm#creating-a-source-and-charge",children:"single API request"}),"  using your secret key."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"creating-a-source",children:"Creating a source"}),"\n",(0,i.jsxs)(n.p,{children:["When the customer confirms that they wish to pay with this payment method, create a new ",(0,i.jsx)(n.a,{href:"/sources-api",children:"source"})," specifying the ",(0,i.jsx)(n.code,{children:"amount"}),", ",(0,i.jsx)(n.code,{children:"currency"}),", and ",(0,i.jsx)(n.code,{children:"type"}),"."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"amount"}),(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:"(required)"})," Amount in subunits of source currency"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"currency"}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:"(required)"}),"  Currency for source as three-letter ISO 4217 code (",(0,i.jsx)(n.code,{children:"THB"})," for Thailand, ",(0,i.jsx)(n.code,{children:"SGD"})," for Singapore, ",(0,i.jsx)(n.code,{children:"MYR"})," for Malaysia)"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"type"}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:"(required)"})," Payment source type: ",(0,i.jsx)(n.code,{children:"alipayplus_mpm"})]})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["The following example demonstrates creating a new ",(0,i.jsx)(n.strong,{children:"Merchant-Presented Mode (C scan B)"})," source for \u0e3f1500.",(0,i.jsx)(n.br,{}),"\n","Replace ",(0,i.jsx)(n.code,{children:"omise_public_key"})," and ",(0,i.jsx)(n.code,{children:"$OMISE_PUBLIC_KEY"})," with the test public key found on ",(0,i.jsx)(n.a,{href:"https://dashboard.omise.co/v2",children:"your dashboard"}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Using ",(0,i.jsx)(n.a,{href:"/omise-js",children:"Omise.js"}),", the ",(0,i.jsx)(n.code,{children:"type"})," parameter is supplied as the first argument to the ",(0,i.jsx)(n.code,{children:"createSource"})," method."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'Omise.setPublicKey(omise_public_key);\r\n\r\nOmise.createSource(\'alipayplus_mpm\', {\r\n  "amount": 150000,\r\n  "currency": "THB"\r\n}, function(statusCode, response) {\r\n  console.log(response)\r\n});\n'})}),"\n",(0,i.jsx)(n.p,{children:"For testing, you can create the same request using curl."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'curl https://api.omise.co/sources \\\r\n  -u $OMISE_PUBLIC_KEY: \\\r\n  -d "amount=150000" \\\r\n  -d "currency=THB" \\\r\n  -d "type=alipayplus_mpm"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'{\r\n  "object": "source",\r\n  "id": "src_test_611bij45gvwnk2y1gah",\r\n  "livemode": false,\r\n  "location": "/sources/src_test_611bij45gvwnk2y1gah",\r\n  "amount": 150000,\r\n  "barcode": null,\r\n  "bank": null,\r\n  "created_at": "2024-09-10T03:57:16Z",\r\n  "currency": "THB",\r\n  "email": null,\r\n  "flow": "offline",\r\n  "installment_term": null,\r\n  "ip": "35.198.236.178",\r\n  "absorption_type": null,\r\n  "name": null,\r\n  "mobile_number": null,\r\n  "phone_number": null,\r\n  "platform_type": null,\r\n  "scannable_code": null,\r\n  "billing": null,\r\n  "shipping": null,\r\n  "items": [],\r\n  "references": null,\r\n  "provider_references": null,\r\n  "store_id": null,\r\n  "store_name": null,\r\n  "terminal_id": null,\r\n  "type": "alipayplus_mpm",\r\n  "zero_interest_installments": null,\r\n  "charge_status": "unknown",\r\n  "receipt_amount": null,\r\n  "discounts": [],\r\n  "promotion_code": null\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"id"})," attribute is the source identifier (begins with ",(0,i.jsx)(n.code,{children:"src"}),")."]}),"\n",(0,i.jsx)(n.h2,{id:"creating-a-charge",children:"Creating a charge"}),"\n",(0,i.jsxs)(n.p,{children:["Create a charge specifying the parameters ",(0,i.jsx)(n.code,{children:"source"}),", ",(0,i.jsx)(n.code,{children:"amount"}),", and ",(0,i.jsx)(n.code,{children:"currency"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"source"})," specifies the source identifier."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"amount"})," and ",(0,i.jsx)(n.code,{children:"currency"})," must match the source."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The following example demonstrates how to create a new charge using ",(0,i.jsx)(n.code,{children:"curl"}),". Replace ",(0,i.jsx)(n.code,{children:"$OMISE_SECRET_KEY"})," with the test secret key on ",(0,i.jsx)(n.a,{href:"https://sso-idp.omise.co/realms/engagement/protocol/openid-connect/auth?client_id=dashboard&redirect_uri=https%3A%2F%2Fdashboard.omise.co%2Fv2&state=aa61f3e1-7f68-4dea-8b3b-ec284cf5b541&response_mode=fragment&response_type=code&scope=openid&nonce=2891768c-7129-4f6a-bee9-f850c2c7e62b&ui_locales=en&code_challenge=VZNxDWaKKiuqN1FTu5eeqlTkJzve7NbkRcsp3QR3u9c&code_challenge_method=S256",children:"your dashboard"}),". Replace ",(0,i.jsx)(n.code,{children:"$SOURCE_ID"})," with the ",(0,i.jsx)(n.code,{children:"id"})," of the source."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'curl https://api.omise.co/charges \\\r\n  -u $OMISE_SECRET_KEY: \\\r\n  -d "amount=150000" \\\r\n  -d "currency=THB" \\\r\n  -d "source=$SOURCE_ID"\r\n\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'{\r\n  "object": "charge",\r\n  "id": "chrg_test_611bij7kcn967m8wk55",\r\n  "location": "/charges/chrg_test_611bij7kcn967m8wk55",\r\n  "amount": 150000,\r\n  "acquirer_reference_number": null,\r\n  "net": 147352,\r\n  "fee": 2475,\r\n  "fee_vat": 173,\r\n  "interest": 0,\r\n  "interest_vat": 0,\r\n  "funding_amount": 150000,\r\n  "refunded_amount": 0,\r\n  "transaction_fees": {\r\n    "fee_flat": "0.0",\r\n    "fee_rate": "1.65",\r\n    "vat_rate": "7.0"\r\n  },\r\n  "platform_fee": {\r\n    "fixed": null,\r\n    "amount": null,\r\n    "percentage": null\r\n  },\r\n  "currency": "THB",\r\n  "funding_currency": "THB",\r\n  "ip": null,\r\n  "refunds": {\r\n    "object": "list",\r\n    "data": [],\r\n    "limit": 20,\r\n    "offset": 0,\r\n    "total": 0,\r\n    "location": "/charges/chrg_test_611bij7kcn967m8wk55/refunds",\r\n    "order": "chronological",\r\n    "from": "1970-01-01T00:00:00Z",\r\n    "to": "2024-09-10T03:57:17Z"\r\n  },\r\n  "link": null,\r\n  "description": null,\r\n  "metadata": {},\r\n  "card": null,\r\n  "source": {\r\n    "object": "source",\r\n    "id": "src_test_611biilt86wyemof3ha",\r\n    "livemode": false,\r\n    "location": "/sources/src_test_611biilt86wyemof3ha",\r\n    "amount": 150000,\r\n    "barcode": null,\r\n    "bank": null,\r\n    "created_at": "2024-09-10T03:57:14Z",\r\n    "currency": "THB",\r\n    "email": null,\r\n    "flow": "offline",\r\n    "installment_term": null,\r\n    "ip": "35.198.236.178",\r\n    "absorption_type": null,\r\n    "name": null,\r\n    "mobile_number": null,\r\n    "phone_number": null,\r\n    "platform_type": null,\r\n    "scannable_code": {\r\n      "object": "barcode",\r\n      "type": "qr",\r\n      "image": {\r\n        "object": "document",\r\n        "livemode": false,\r\n        "id": "docu_test_611bij9cng91h6xcqoe",\r\n        "deleted": false,\r\n        "filename": "qrcode.svg",\r\n        "location": "/charges/chrg_test_611bij7kcn967m8wk55/documents/docu_test_611bij9cng91h6xcqoe",\r\n        "kind": "qr",\r\n        "download_uri": "https://api.omise.co/charges/chrg_test_611bij7kcn967m8wk55/documents/docu_test_611bij9cng91h6xcqoe/downloads/FED7CA673265A075",\r\n        "created_at": "2024-09-10T03:57:17Z"\r\n      }\r\n    },\r\n    "billing": null,\r\n    "shipping": null,\r\n    "items": [],\r\n    "references": null,\r\n    "provider_references": null,\r\n    "store_id": null,\r\n    "store_name": null,\r\n    "terminal_id": null,\r\n    "type": "alipayplus_mpm",\r\n    "zero_interest_installments": null,\r\n    "charge_status": "pending",\r\n    "receipt_amount": null,\r\n    "discounts": [],\r\n    "promotion_code": null\r\n  },\r\n  "schedule": null,\r\n  "linked_account": null,\r\n  "customer": null,\r\n  "dispute": null,\r\n  "transaction": null,\r\n  "failure_code": null,\r\n  "failure_message": null,\r\n  "status": "pending",\r\n  "authorize_uri": null,\r\n  "return_uri": null,\r\n  "created_at": "2024-09-10T03:57:17Z",\r\n  "paid_at": null,\r\n  "authorized_at": null,\r\n  "expires_at": "2024-09-11T03:57:17Z",\r\n  "expired_at": null,\r\n  "reversed_at": null,\r\n  "zero_interest_installments": false,\r\n  "branch": null,\r\n  "terminal": null,\r\n  "device": null,\r\n  "authorized": false,\r\n  "capturable": false,\r\n  "capture": true,\r\n  "disputable": false,\r\n  "livemode": false,\r\n  "refundable": false,\r\n  "partially_refundable": false,\r\n  "reversed": false,\r\n  "reversible": false,\r\n  "voided": false,\r\n  "paid": false,\r\n  "expired": false,\r\n  "can_perform_void": false,\r\n  "approval_code": null\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"creating-a-source-and-charge",children:"Creating a source and charge"}),"\n",(0,i.jsx)(n.p,{children:"Alternatively, you can create and charge a source in a single API request."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'curl https://api.omise.co/charges \\\r\n  -u $OMISE_SECRET_KEY: \\\r\n  -d "amount=150000" \\\r\n  -d "currency=THB" \\\r\n  -d "source[type]=alipayplus_mpm"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"setting-the-charge-to-expire",children:"Setting the charge to expire"}),"\n",(0,i.jsxs)(n.p,{children:["Merchant-Presented Mode (C scan B) charges that have not yet been authorized (",(0,i.jsx)(n.code,{children:"status=pending"}),") can be set to expire immediately, canceling the charge."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"curl https://api.omise.co/charges/$CHARGE_ID/expire \\\r\n  -X POST \\\r\n  -u $OMISE_SECRET_KEY:\n"})}),"\n",(0,i.jsx)(n.h2,{id:"completing-the-charge",children:"Completing the charge"}),"\n",(0,i.jsxs)(n.p,{children:["You have created a new charge with its ",(0,i.jsx)(n.code,{children:"status"})," set to ",(0,i.jsx)(n.code,{children:"pending"}),". Other possible values for charge ",(0,i.jsx)(n.code,{children:"status"})," are ",(0,i.jsx)(n.code,{children:"successful"}),", ",(0,i.jsx)(n.code,{children:"failed"}),", and ",(0,i.jsx)(n.code,{children:"expired"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"The following sections detail how to authorize a charge, receive its completion webhook event, and update its status."}),"\n",(0,i.jsx)(n.mermaid,{value:'sequenceDiagram\r\n    participant customer\r\n    participant omise.js\r\n    participant merchant\r\n    participant api.omise.co\r\n    participant offline provider\r\n\r\n    customer->>omise.js: Send payment details for purchase\r\n    omise.js->>api.omise.co: Request source using payment details\r\n    api.omise.co--\x3e>omise.js: Return source\r\n    omise.js--\x3e>merchant: Merchant gets returned source\r\n    merchant->>api.omise.co: Request charge using source and purchase details\r\n   \r\n    api.omise.co--x merchant: Send "charge.create" webhook\r\n    api.omise.co--\x3e>merchant: Return charge\r\n    merchant->>offline provider: Provide payment or charge authorization at offline provider\r\n    offline provider--\x3e>merchant: Return result of payment or charge authorization\r\n    offline provider--\x3e>api.omise.co: Return result of payment or charge authorization\r\n   \r\n    api.omise.co--x merchant: Send "charge.complete" webhook\r\n    merchant--\x3e>customer: Send charge result (e.g., via email)'}),"\n",(0,i.jsx)(n.h2,{id:"authorizing-the-charge",children:"Authorizing the charge"}),"\n",(0,i.jsx)(n.p,{children:"Present the customer with a QR code generated at charge creation. The customer scans the QR code using their phone to authorize the charge."}),"\n",(0,i.jsxs)(n.p,{children:["You can simulate the authorization phase in test mode. Go to the specific charge on the dashboard, click ",(0,i.jsx)(n.code,{children:"Actions"}),", and manually mark the charge as ",(0,i.jsx)(n.code,{children:"Successful"})," or ",(0,i.jsx)(n.code,{children:"Failed"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Find the QR code nested within the charge object as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:"charge:\r\n  source:\r\n    scannable_code:\r\n      image:\r\n        download_uri: QR code image to present to the customer\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\r\n  "object": "barcode",\r\n  "type": "qr",\r\n  "image": {\r\n    "object": "document",\r\n    "livemode": false,\r\n    "id": "docu_test_611biix70q8edqvo2tk",\r\n    "deleted": false,\r\n    "filename": "qrcode.svg",\r\n    "location": "/charges/chrg_test_611biisxzxinpqmp4gt/documents/docu_test_611biix70q8edqvo2tk",\r\n    "kind": "qr",\r\n    "download_uri": "https://api.omise.co/charges/chrg_test_611biisxzxinpqmp4gt/documents/docu_test_611biix70q8edqvo2tk/downloads/754A57240DF61325",\r\n    "created_at": "2024-09-10T03:57:15Z"\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"receiving-the-charge-completion-event",children:"Receiving the charge completion event"}),"\n",(0,i.jsxs)(n.p,{children:["The best way to be notified about a charge completion is by using ",(0,i.jsx)(n.a,{href:"/api-webhooks",children:"webhook events"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Set up a location on the merchant server to receive webhook events and add this location as a webhook endpoint on the dashboard."}),"\n",(0,i.jsx)(n.h2,{id:"checking-the-charge-status",children:"Checking the charge status"}),"\n",(0,i.jsxs)(n.p,{children:["After receiving this event, retrieve the charge using its ",(0,i.jsx)(n.code,{children:"id"})," and confirm that its ",(0,i.jsx)(n.code,{children:"status"})," matches the ",(0,i.jsx)(n.code,{children:"status"})," of the charge contained in the event."]}),"\n",(0,i.jsxs)(n.p,{children:["If the value of ",(0,i.jsx)(n.code,{children:"status"})," is ",(0,i.jsx)(n.code,{children:"successful"}),", you got paid."]}),"\n",(0,i.jsxs)(n.p,{children:["If the value of ",(0,i.jsx)(n.code,{children:"status"})," is ",(0,i.jsx)(n.code,{children:"failed"}),", check the ",(0,i.jsx)(n.code,{children:"failure_code"})," and ",(0,i.jsx)(n.code,{children:"failure_message"})," in the charge object for an explanation."]}),"\n",(0,i.jsx)(n.p,{children:"Possible failure codes are as follows."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Failure Code"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"payment_expired"})}),(0,i.jsx)(n.td,{children:"Payment expired."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"payment_rejected"})}),(0,i.jsx)(n.td,{children:"Payment rejected by the issuer."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"insufficient_fund"})}),(0,i.jsx)(n.td,{children:"Insufficient funds in the account or the payment method has reached its limit."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"failed_processing"})}),(0,i.jsx)(n.td,{children:"General payment processing failure."})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"voids-and-refunds",children:"Voids and refunds"}),"\n",(0,i.jsx)(n.p,{children:"You can void Merchant-Presented Mode (C scan B) charges until 16:15 UTC on the transaction date and process partial or full refunds within 1 year of the transaction."}),"\n",(0,i.jsx)(n.h2,{id:"limits",children:"Limits"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Thailand"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Minimum: ",(0,i.jsx)(n.code,{children:"2000"})," (THB 20.00)"]}),"\n",(0,i.jsxs)(n.li,{children:["Maximum: ",(0,i.jsx)(n.code,{children:"15000000"})," (THB 150,000.00)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Singapore"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Minimum: ",(0,i.jsx)(n.code,{children:"100"})," (SGD 1.00)"]}),"\n",(0,i.jsxs)(n.li,{children:["Maximum: ",(0,i.jsx)(n.code,{children:"2000000"})," (SGD 20,000.00)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Malaysia"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Minimum: ",(0,i.jsx)(n.code,{children:"100"})," (MYR 1.00)"]}),"\n",(0,i.jsxs)(n.li,{children:["Maximum: ",(0,i.jsx)(n.code,{children:"3000000"})," (MYR 30,000.00)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"related-api-documentation",children:"Related API documentation"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#",children:"Charge"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#",children:"Source"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#",children:"Webhook"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"how-to-check-the-public-key-and-secret-key",children:"How to check the public key and secret key"}),"\n",(0,i.jsx)(n.p,{children:"For information on obtaining and checking the public and secret keys, please refer to this document."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>a});var s=r(96540);const i={},t=s.createContext(i);function c(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(t.Provider,{value:n},e.children)}},42656:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/alipayplus-mpm-5e4d8016b40c4c4bce4762d6c456c164.png"}}]);